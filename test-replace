#!/usr/bin/env bash

FILE_NAME=foo.txt
FILE_TO_REPLACE=test-files/$FILE_NAME
EXPECTED_DIR=test-files/expected-result

assert_files_match() {
  expected_file=$1
  file_to_compare=$2
  cmp $expected_file $file_to_compare
  if [ $? -ne 0 ]; then
    echo "Error replacing values"
    exit 1
  fi
}

source ./code # To call its functions

cp test-replace /tmp/

# Test case sensitive contains
# The replace must be done.
cp test-files/sample-file/$FILE_NAME $FILE_TO_REPLACE
replace xxx -
assert_files_match $EXPECTED_DIR/replace-using-contain.txt $FILE_TO_REPLACE
rm $FILE_TO_REPLACE
# The replace must not be done. Upper and lowercase letters does not match
cp test-files/sample-file/$FILE_NAME $FILE_TO_REPLACE
replace xXx -
assert_files_match test-files/sample-file/$FILE_NAME $FILE_TO_REPLACE
rm $FILE_TO_REPLACE
# The replace must not be done. There is not exact match
cp test-files/sample-file/$FILE_NAME $FILE_TO_REPLACE
replace -w xxx -
assert_files_match test-files/sample-file/$FILE_NAME $FILE_TO_REPLACE
rm $FILE_TO_REPLACE

# Avoid modifications when running ./replace
cp /tmp/test-replace .
